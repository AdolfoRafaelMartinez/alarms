<section data-ng-init="findProjects()">
	<div class="page-header row">
		<div class="col-sm-4">
			<input type="text" class="form-control" ng-model="search" placeholder="search..." />
		</div>
		<div class="col-sm- text-right">
			<a class="btn btn-primary" href="https://kawa.signalforest.com" target="_blank">Kawa XML</a>
		</div>
	</div>

	<div class="orphan-plans" ng-if="show_orphans">
		<div data-ng-repeat="plan in plans" class="list-group-item" data-drag="true" jqyoui-draggable="{animate: true}" data-jqyoui-options="{helper: 'clone', revert: 'invalid'}" ng-click="gotoPlan(plan)">
			<small class="list-group-item-text">
				<span data-ng-bind="plan.created | date:'mediumDate'"></span>
			</small>
			<img ng-src="/uploads/{{ plan.thumb }}" /><br />
			<span class="list-group-item-heading" data-ng-bind="plan.title"></span>
		</div>
		<div class="alert alert-warning text-center" data-ng-if="plans.$resolved && !plans.length">
			No orphan plans.
		</div>
	</div>

	<div class="list-group projects" ng-class="{'v1': show_orphans}">
		<h2>Projects <span ng-show="projects.length">({{ projects.length }})</span></h2>
		<div>
			<div ng-click="showCreate('project')" class="list-group-item create-new" ng-class="{'shadowItem': selected.project}">
              <span ng-if="!new.project"><i class="glyphicon glyphicon-plus"></i> Create</span>
				<div ng-show="new.project">
					<form>
						<div class="form-group"> <input type="text" class="form-control" placeholder="Project name..." focus-me="{{ new.project }}" ng-model="new.project.title" /> </div>
						<button type="submit" class="btn btn-primary" ng-click="create($event, 'project')">Create</button>
						<button class="btn btn-danger" ng-click="cancelCreate($event, 'project')">Cancel</button>
					</form>
				</div>
			</div>
			<div data-ng-repeat="project in projects | filter: search | orderBy: sort.projects" ng-click="selectProject(project)" class="list-group-item" role="button"
				 ng-class="{'shadowItem': selected.project && project != selected.project, 'selectedItem': project == selected.project}">

				<div class="topright text-right">
					<a href ng-click="askDeleteProject(project)"><i class="glyphicon glyphicon-remove"></i></a>
				</div>
				<div class="bottomright">
					<a href ng-click="showSettings('project', project, $event)"><i class="glyphicon glyphicon-cog"></i></a>
				</div>

				<img ng-if="project.details.client.logo" ng-src="{{ project.details.client.logo }}" />
				<img ng-if="!project.details.client.logo" ng-src="/modules/core/img/brand/frog.png" />
				<h3 class="list-group-item-heading" data-ng-bind="project.title"></h3>
				<small class="list-group-item-text">
					<span data-ng-bind="project.created | date:'mediumDate'"></span>
				</small><br />
				<span>Sites: {{ project.sites.length }}</span><br />
				<span>Buildings: {{ getBuildingCount(project) }}</span><br />
				<span>Floors: {{ getFloorCount(project) }}</span><br />
			</div>
		</div>
	</div>

	<div class="list-group sites" ng-class="{'v1': show_orphans}">
		<h2>Sites <span ng-show="selected.project.sites.length">({{ selected.project.sites.length }})</span></h2>
		<div>
			<div ng-click="showCreate('site')" class="list-group-item create-new" ng-show="selected.project" ng-class="{'shadowItem': selected.site, 'selected': new.site}">
				<span ng-if="!new.site"><i class="glyphicon glyphicon-plus"></i> Create</span>
				<div ng-show="new.site">
					<form>
						<div class="form-group"> <input type="text" class="form-control" placeholder="Site name..." focus-me="{{ new.site }}" ng-model="new.site.name" /> </div>
						<button type="submit" class="btn btn-primary" ng-click="create($event, 'site')">Create</button>
						<button class="btn btn-danger" ng-click="cancelCreate($event, 'site')">Cancel</button>
					</form>
				</div>
			</div>
			<div data-ng-repeat="site in selected.project.sites | filter: search | orderBy: sort.sites" ng-click="selectSite(site)" class="list-group-item"
				   ng-class="{'shadowItem': selected.site && site._id != selected.site._id, 'selectedItem': site._id == selected.site._id}" >

			   <div class="topright text-right">
				   <a href ng-click="askDeleteSite(site)"><i class="glyphicon glyphicon-remove"></i></a>
			   </div>
			   <div class="bottomright">
				   <a href ng-click="showSettings('site', site, $event)"><i class="glyphicon glyphicon-cog"></i></a>
			   </div>

               <img ng-if="site.details.client.logo" ng-src="{{ site.details.client.logo }}" />
			   <img ng-if="!site.details.client.logo" ng-src="/modules/core/img/brand/frog.png" />
			   <h3 class="list-group-item-heading" data-ng-bind="site.name"></h3>
			   <small class="list-group-item-text">
				   <span data-ng-bind="site.created | date:'mediumDate'"></span><br />
				   <span>Buildings: </span><span data-ng-bind="site.buildings.length"></span>
			   </small>
			</div>
		</div>
	</div>

	<div class="list-group buildings" ng-class="{'v1': show_orphans}">
		<h2>Buildings <span ng-show="selected.site.buildings.length">({{ selected.site.buildings.length }})</span></h2>
		<div>
			<div ng-click="showCreate('building')" class="list-group-item create-new" ng-show="selected.site"
					ng-class="{'shadowItem': selected.building, 'selected': new.building}" >
				<span ng-if="!new.building"><i class="glyphicon glyphicon-plus"></i> Create</span>
				<div ng-show="new.building">
					<form>
						<div class="form-group"> <input type="text" class="form-control" placeholder="building name..." focus-me="{{ new.building }}" ng-model="new.building.name" /> </div>
						<button class="btn btn-primary" ng-click="create($event, 'building')">Create</button>
						<button class="btn btn-danger" ng-click="cancelCreate($event, 'building')">Cancel</button>
					</form>
				</div>
			</div>
			<div data-ng-repeat="bldg in selected.site.buildings | filter: search | orderBy: sort.buildings" class="list-group-item" ng-click="showBuilding(bldg)" data-drop="true" jqyoui-droppable="{onDrop: 'onOrphanDrop'}">

				<div class="topright text-right">
					<a href ng-click="askDeleteBuilding(bldg, $event)"><i class="glyphicon glyphicon-remove"></i></a>
				</div>
				<div class="bottomright">
					<a href ng-click="showSettings('bldg', bldg, $event)"><i class="glyphicon glyphicon-cog"></i></a>
				</div>

                <img ng-if="bldg.details.client.logo" ng-src="{{ bldg.details.client.logo }}" />
				<img ng-if="!bldg.details.client.logo" ng-src="/modules/core/img/brand/frog.png" />
				<h3 class="list-group-item-heading" data-ng-bind="bldg.name"></h3>
				<small class="list-group-item-text">
					<span data-ng-bind="bldg.created | date:'mediumDate'"></span><br />
					<span>Floors: </span><span data-ng-bind="bldg.plans.length"></span>
				</small>
			</div>
		</div>
	</div>

</section>

<script type="text/ng-template" id="deleteModal.html">
<div class="modal fade">
	<div class="modal-dialog">
	  <div class="modal-content">
		<div class="modal-header">
		  <button type="button" class="close" ng-click="close('Cancel')" data-dismiss="modal" aria-hidden="true"><i class="glyphicon glyphicon-remove"></i></button>
		  <h2 class="modal-title">Delete {{ item }}</h2>
		</div>
		<div class="modal-body">
		  <p>Are you sure you want to delete this {{ item }}?</p>
		</div>
		<div class="modal-footer">
		  <button type="button" ng-click="close()" class="btn btn-default" data-dismiss="modal">Cancel</button>
		  <button type="button" ng-click="close('Yes')" class="btn btn-danger" data-dismiss="modal">Yes</button>
		</div>
	  </div>
	</div>
  </div>
</script>
