<section data-ng-init="findProjects()">
	<div class="page-header row">
		<div class="col-sm-6">
			<input type="text" class="form-control" ng-model="search" placeholder="search..." />
		</div>
		<div class="col-sm-6 text-right">
			<button class="btn btn-primary" ng-click="toggleOrphans()">Show Orphan Floorplans</button>
		</div>
	</div>

	<div class="orphan-plans" ng-if="show_orphans">
		<div data-ng-repeat="plan in plans" class="list-group-item" data-drag="true" jqyoui-draggable="{animate: true}" data-jqyoui-options="{helper: 'clone', revert: 'invalid'}" ng-click="gotoPlan(plan)">
			<small class="list-group-item-text">
				<span data-ng-bind="plan.created | date:'mediumDate'"></span>
			</small>
			<img ng-src="/uploads/{{ plan.thumb }}" /><br />
			<span class="list-group-item-heading" data-ng-bind="plan.title"></span>
		</div>
		<div class="alert alert-warning text-center" data-ng-if="plans.$resolved && !plans.length">
			No orphan plans.
		</div>
	</div>

	<div class="list-group projects" ng-class="{'v1': show_orphans}">
		<h2>Projects <span ng-show="projects.length">({{ projects.length }})</span></h2>
		<div>
			<div ng-click="showCreate('project')" class="list-group-item create-new" ng-class="{'shadowItem': selected.project}">
				<span ng-if="!new.project">Create</span>
				<div ng-show="new.project">
					<form>
						<div class="form-group"> <input type="text" class="form-control" placeholder="Project name..." focus-me="{{ new.project }}" ng-model="new.project.title" /> </div>
						<button type="submit" class="btn btn-primary" ng-click="create($event, 'project')">Create</button>
						<button class="btn btn-danger" ng-click="cancelCreate($event, 'project')">Cancel</button>
					</form>
				</div>
			</div>
			<div data-ng-repeat="project in projects | filter: search | orderBy: sort.projects" ng-click="selectProject(project)" class="list-group-item" role="button"
				 ng-class="{'shadowItem': selected.project && project != selected.project, 'selectedItem': project == selected.project}">

				<div class="topright text-right">
					<a href ng-click="askDeleteProject(project)"><i class="glyphicon glyphicon-remove"></i></a>
				</div>
				<div class="bottomright">
					<a href ng-click="showSettings(project)"><i class="glyphicon glyphicon-cog"></i></a>
				</div>

				<img ng-if="project.thumb" ng-src="{{ project.thumb }}" />
				<img ng-if="!project.thumb" ng-src="/modules/core/img/brand/frog.png" />
				<h3 class="list-group-item-heading" data-ng-bind="project.title"></h3>
				<small class="list-group-item-text">
					<span data-ng-bind="project.created | date:'mediumDate'"></span>
				</small><br />
				<span>Sites: {{ project.sites.length }}</span><br />
				<span>Buildings: {{ getBuildingCount(project) }}</span><br />
				<span>Floors: {{ getFloorCount(project) }}</span><br />
			</div>
		</div>
	</div>

	<div class="list-group sites" ng-class="{'v1': show_orphans}">
		<h2>Sites <span ng-show="selected.project.sites.length">({{ selected.project.sites.length }})</span></h2>
		<div>
			<div ng-click="showCreate('site')" class="list-group-item create-new" ng-show="selected.project" ng-class="{'shadowItem': selected.site, 'selected': new.site}">
				<span ng-if="!new.site">Create</span>
				<div ng-show="new.site">
					<form>
						<div class="form-group"> <input type="text" class="form-control" placeholder="Site name..." focus-me="{{ new.site }}" ng-model="new.site.name" /> </div>
						<button type="submit" class="btn btn-primary" ng-click="create($event, 'site')">Create</button>
						<button class="btn btn-danger" ng-click="cancelCreate($event, 'site')">Cancel</button>
					</form>
				</div>
			</div>
			<div data-ng-repeat="site in selected.project.sites | filter: search | orderBy: sort.sites" ng-click="selectSite(site)" class="list-group-item"
				   ng-class="{'shadowItem': selected.site && site != selected.site, 'selectedItem': site == selected.site}" >

			   <div class="topright text-right">
				   <a href ng-click="askDeleteSite(site)"><i class="glyphicon glyphicon-remove"></i></a>
			   </div>
			   <div class="bottomright">
				   <a href ng-click="showSettings(site)"><i class="glyphicon glyphicon-cog"></i></a>
			   </div>

			   <img ng-if="site.thumb" ng-src="/uploads/{{ site.thumb }}" />
			   <img ng-if="!site.thumb" ng-src="/modules/core/img/brand/frog.png" />
			   <h3 class="list-group-item-heading" data-ng-bind="site.name"></h3>
			   <small class="list-group-item-text">
				   <span data-ng-bind="site.created | date:'mediumDate'"></span><br />
				   <span>Buildings: </span><span data-ng-bind="site.buildings.length"></span>
			   </small>
			</div>
		</div>
	</div>

	<div class="list-group buildings" ng-class="{'v1': show_orphans}">
		<h2>Buildings <span ng-show="selected.site.buildings.length">({{ selected.site.buildings.length }})</span></h2>
		<div>
			<div ng-click="showCreate('building')" class="list-group-item create-new" ng-show="selected.site"
					ng-class="{'shadowItem': selected.building, 'selected': new.building}" >
				<span ng-if="!new.building">Create</span>
				<div ng-show="new.building">
					<form>
						<div class="form-group"> <input type="text" class="form-control" placeholder="building name..." focus-me="{{ new.building }}" ng-model="new.building.name" /> </div>
						<button class="btn btn-primary" ng-click="create($event, 'building')">Create</button>
						<button class="btn btn-danger" ng-click="cancelCreate($event, 'building')">Cancel</button>
					</form>
				</div>
			</div>
			<div data-ng-repeat="bldg in selected.site.buildings | filter: search | orderBy: sort.buildings" class="list-group-item" ng-click="showBuilding(bldg)" data-drop="true" jqyoui-droppable="{onDrop: 'onOrphanDrop'}">

				<div class="topright text-right">
					<a href ng-click="askDeleteBuilding(bldg, $event)"><i class="glyphicon glyphicon-remove"></i></a>
				</div>
			   <div class="bottomright">
				   <a href ng-click="showSettings(bldg, $event)"><i class="glyphicon glyphicon-cog"></i></a>
			   </div>

				<img ng-if="bldg.thumb" ng-src="/uploads/{{ bldg.thumb }}" />
				<img ng-if="!bldg.thumb" ng-src="/modules/core/img/brand/frog.png" />
				<h3 class="list-group-item-heading" data-ng-bind="bldg.name"></h3>
				<small class="list-group-item-text">
					<span data-ng-bind="bldg.created | date:'mediumDate'"></span><br />
					<span>Floors: </span><span data-ng-bind="bldg.plans.length"></span>
				</small>
			</div>
		</div>
	</div>

</section>

<script type="text/ng-template" id="deleteModal.html">
<div class="modal fade">
	<div class="modal-dialog">
	  <div class="modal-content">
		<div class="modal-header">
		  <button type="button" class="close" ng-click="close('Cancel')" data-dismiss="modal" aria-hidden="true"><i class="glyphicon glyphicon-remove"></i></button>
		  <h2 class="modal-title">Delete {{ item }}</h2>
		</div>
		<div class="modal-body">
		  <p>Are you sure you want to delete this {{ item }}?</p>
		</div>
		<div class="modal-footer">
		  <button type="button" ng-click="close()" class="btn btn-default" data-dismiss="modal">Cancel</button>
		  <button type="button" ng-click="close('Yes')" class="btn btn-danger" data-dismiss="modal">Yes</button>
		</div>
	  </div>
	</div>
  </div>
</script>

<script type="text/ng-template" id="settingsModal.html">
<div class="modal fade">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" ng-click="close('Cancel')" data-dismiss="modal" aria-hidden="true"><i class="glyphicon glyphicon-remove"></i></button>
				<h2 class="modal-title">{{ item.name || item.title }} - Settings</h2>
			</div>
			<div class="modal-body">
<!-- plan properties -->
<div class="panel-body overlay-sheet sheet-bg">
	<button class="btn btn-secondary" ng-click="togglePlanProperties()"><i class="glyphicon glyphicon-backward"></i> Back</button>
    <div class="row">
        <div class="panel-group col-lg-12" id="pp_accordion" role="tablist" aria-multiselectable="true">
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="pp_client">
                    <h4 class="panel-title">
                        <a role="button" data-toggle="collapse" data-parent="#pp_accordion" href="#collapseClient" aria-expanded="true" aria-controls="collapseClient">
                            Site properties
                        </a>
                    </h4>
                </div>
                <div id="collapseClient" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="pp_client">
                    <div class="panel-body">
                        <div class="form-group" ng-if="!pp_edit['client']">
                            <div class="clickable list-group-item" ng-click="toggleEdit('client')">
                                <div><span>Client:</span> <em ng-bind="plan.details.client.name"></em></div>
                                <div ng-if="plan.details.client.logo" class="small-logo">
                                    <img ng-src="{{ plan.details.client.logo }}" />
                                </div>
                                <div><span>Project:</span> <em ng-bind="plan.details.project"></em></div>
                                <div><span>Site:</span> <em ng-bind="plan.details.site"></em></div>
                                <div><span>Building:</span> <em ng-bind="plan.details.building"></em></div>
                                <div><span>Floor:</span> <em ng-bind="plan.floor"></em></div>
                                <div>
                                    <span>Address:</span> <em ng-bind="plan.details.address"></em>
                                    <em ng-bind="plan.details.city"></em> <em ng-bind="plan.details.state"></em> <em ng-bind="plan.details.zipcode"></em>
                                </div>
                                <div>
                                    <span>MSP:</span> <em ng-bind="plan.details.msp.name"></em>
                                    <div ng-if="plan.details.msp.logo">
                                        <img ng-src="{{ plan.details.msp.logo }}" class="small-logo" />
                                    </div>
                                </div>
                                <div>
                                    <span>Designer:</span> <em ng-bind="plan.details.designer.name"></em>
                                    <span ng-if="plan.details.designer.position">, <em ng-bind="plan.details.designer.position"></em> </span>
                                </div>
                            </div>
                        </div>
                        <div ng-show="pp_edit['client']" class="plan-property-item">
                            <div class="form-group row">
                                <label class="col-sm-2 ptop5 text-right form-control-label">Client</label>
                                <div class="col-sm-10"><input type="text" ng-model="plan.details.client.name" class="form-control" placeholder="client name ..." /></div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-2 ptop5 text-right form-control-label">Client Logo</label>
                                <div class="col-sm-10"><input type="text" ng-model="plan.details.client.logo" class="form-control" placeholder="Client logo URL ..." /></div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-2 ptop5 text-right form-control-label">Project</label>
                                <div class="col-sm-10"><input type="text" readonly ng-model="plan.details.project" class="form-control" placeholder="project ..." /></div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-2 ptop5 text-right form-control-label">Site</label>
                                <div class="col-sm-10"><input type="text" readonly ng-model="plan.details.site" class="form-control" placeholder="site ..." /></div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-2 ptop5 text-right form-control-label">Building</label>
                                <div class="col-sm-10"><input type="text" readonly ng-model="plan.details.building" class="form-control" placeholder="building ..." /></div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-2 ptop5 text-right form-control-label">Floor</label>
                                <div class="col-sm-10"><input type="text" ng-model="plan.floor" class="form-control" placeholder="##" /></div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-2 ptop5 text-right form-control-label">Address</label>
                                <div class="col-sm-10"><input type="text" ng-model="plan.details.address" class="form-control" placeholder="address"/></div>
                            </div>
                            <div class="form-group row">
                                <div class="col-sm-offset-2 col-sm-4"><input type="text" ng-model="plan.details.city" class="form-control" placeholder="city" /></div>
                                <div class="col-sm-3"><input type="text" ng-model="plan.details.state" class="form-control" placeholder="state" /></div>
                                <div class="col-sm-3"><input type="text" ng-model="plan.details.zipcode" class="form-control" placeholder="zipcode" /></div>
                            </div>

                            <div class="form-group row">
                                <label class="col-sm-2 ptop5 text-right form-control-label">MSP</label>
                                <div class="col-sm-10"><input type="text" ng-model="plan.details.msp.name" class="form-control" placeholder="MSP name"/></div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-2 ptop5 text-right form-control-label">MSP logo</label>
                                <div class="col-sm-10"><input type="text" ng-model="plan.details.msp.logo" class="form-control" placeholder="MSP logo URL (gif, jpg, png)"/></div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-2 ptop5 text-right form-control-label">Designer</label>
                                <div class="col-sm-10"><input type="text" ng-model="plan.details.designer.name" class="form-control" placeholder="Designer name"/></div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-2 ptop5 text-right form-control-label">Designer position</label>
                                <div class="col-sm-10"><input type="text" ng-model="plan.details.designer.position" class="form-control" placeholder="Designer position"/></div>
                            </div>

                            <div class="col-lg-12">
                                <div class="form-group row">
                                    <div class="col-sm-offset-2 col-sm-10">
                                        <button type="submit" class="btn btn-primary" ng-click="savePlanProperties();">Save</button>
                                        <button type="submit" class="btn btn-default pull-right" ng-click="toggleEdit('client')">Cancel</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="pp_contacts">
                    <h4 class="panel-title">
                        <a role="button" data-toggle="collapse" data-parent="#pp_accordion" href="#collapseContacts" aria-expanded="true" aria-controls="collapseContacts">
                            Contacts
                        </a>
						<a href ng-click="addContact()"> <i class="glyphicon glyphicon-plus-sign"></i> </a>
                    </h4>
                </div>
                <div id="collapseContacts" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="pp_contacts">
                    <div class="panel-body">
                        <div class="form-group row" ng-hide="pp_edit['contacts']">
                            <div class="col-lg-12">
                                <div class="col-lg-3 clickable list-group-item" ng-repeat="(contactIndex, contact) in plan.details.contacts" ng-click="toggleEdit('contacts', contact)">
									<div class="topright text-right">
										<a href ng-click="removeContact(contactIndex)">
											<i class="glyphicon glyphicon-remove" ng-click="removeContact(contactIndex)"></i>
										</a>
									</div>
                                    <div class="form-group">
                                        <div>
                                            <span>Type:</span> <em ng-bind="contact.type"></em>
                                        </div>
                                        <div><span>Name:</span> <em ng-bind="contact.name"></em></div>
                                        <div><span>Position:</span> <em ng-bind="contact.position"></em></div>
                                        <div><span>Phone:</span> <em ng-bind="contact.phone"></em></div>
                                        <div><span>Email:</span> <em ng-bind="contact.email"></em></div>
                                    </div>
                                </div>
                                <div class="form-group col-log-12" ng-if="!plan.details.contacts.length">
                                    <i>Please add some contacts for this plan.</i>
                                </div>
                            </div>
                        </div>

                        <div class="form-group edit-contact" ng-show="pp_edit['contacts']">
                            <form>
                                <div class="col-lg-12 plan-property-item">
                                    <div class="form-group row">
                                        <label class="col-sm-2 ptop5 text-right form-control-label">Type</label>
                                        <div class="col-sm-10"><input type="text" ng-model="edit_prop.type" class="form-control" placeholder="site contact, installer, etc..."/></div>
                                    </div>
                                    <div class="form-group row">
                                        <label class="col-sm-2 ptop5 text-right form-control-label">Contact</label>
                                        <div class="col-sm-10"><input type="text" ng-model="edit_prop.name" class="form-control" placeholder="Name"/></div>
                                    </div>
                                    <div class="form-group row">
                                        <label class="col-sm-2 ptop5 text-right form-control-label">Position</label>
                                        <div class="col-sm-10"><input type="text" ng-model="edit_prop.position" class="form-control" placeholder="Position"/></div>
                                    </div>
                                    <div class="form-group row">
                                        <label class="col-sm-2 ptop5 text-right form-control-label">Phone</label>
                                        <div class="col-sm-10"><input type="text" ng-model="edit_prop.phone" class="form-control" placeholder="Phone"/></div>
                                    </div>
                                    <div class="form-group row">
                                        <label class="col-sm-2 ptop5 text-right form-control-label">Email</label>
                                        <div class="col-sm-10"><input type="text" ng-model="edit_prop.email" class="form-control" placeholder="Email"/></div>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-sm-offset-2 col-sm-10">
                                            <button type="submit" class="btn btn-primary" ng-click="saveContact();">Save</button>
                                            <button class="btn btn-default pull-right" ng-click="toggleEdit('contacts')">Cancel</button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>

                    </div>
                </div>
            </div>

            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="pp_controllers">
                    <h4 class="panel-title">
                        <a role="button" data-toggle="collapse" data-parent="#pp_accordion" href="#collapseControllers" aria-expanded="true" aria-controls="collapseControllers">
                            WiFi Details
                        </a>
                    </h4>
                </div>
                <div id="collapseControllers" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="pp_controllers">
                    <div class="panel-body">
                        <div class="form-group row" ng-hide="pp_edit['controllers']">
                            <div class="col-lg-12">
                                <div class="form-group">
                                    <div>
                                        <label class="form-control-label">Controller Present?</label>
                                        <md-switch aria-label="controller present" ng-change="checkController()" ng-model="plan.details.ctrlPresent">
                                            {{ plan.details.ctrlPresent ? 'YES' : 'No (Instant Cluster)' }}
                                        </md-switch>
                                    </div>
                                </div>
                                <div class="col-lg-3 clickable list-group-item" ng-repeat="(ctrlIndex, ctrl) in plan.details.controllers" ng-if="plan.details.ctrlPresent" ng-click="toggleEdit('controllers', ctrl)">
									<div class="topright text-right">
										<a href ng-click="removeController(ctrlIndex)" style="padding-left: 1em;">
											<i class="glyphicon glyphicon-remove"></i>
										</a>
									</div>
                                    <div class="form-group">
                                        <div>
                                            <span>Country Code:</span> <em ng-bind="ctrl.country"></em>
                                        </div>

                                        <div><span>Model:</span> <em ng-bind="ctrl.model"></em></div>
                                        <div><span>Description:</span> <em ng-bind="ctrl.description"></em></div>
                                        <div><span>HA:</span>
                                            <span ng-if="ctrl.ha"><i class="glyphicon glyphicon-ok-circle green"></i></span>
                                            <span ng-if="!ctrl.ha"><i class="glyphicon glyphicon-remove-circle red"></i></span>
                                        </div>
                                        <div><span>AP/AM Licenses:</span> <span ng-bind="ctrl.lic.ap.qty"></span></div>
                                        <div><span>PEFNG License:</span>
                                            <span ng-if="plan.details.lic.pefng"><i class="glyphicon glyphicon-ok-circle green"></i></span>
                                            <span ng-if="!plan.details.lic.pefng"><i class="glyphicon glyphicon-remove-circle red"></i></span>
                                        </div>
                                        <div><span>RFP License:</span>
                                            <span ng-if="plan.details.lic.rfp"><i class="glyphicon glyphicon-ok-circle green"></i></span>
                                            <span ng-if="!plan.details.lic.rfp"><i class="glyphicon glyphicon-remove-circle red"></i></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group edit-contact" ng-show="pp_edit['controllers']">
                            <form>
                                <div class="col-lg-12 plan-property-item">
                                    <div class="form-group row">
                                        <label class="col-sm-6 ptop5 text-right form-control-label">Country Code</label>
                                        <div class="col-sm-6"><input type="text" ng-model="edit_prop.country" class="form-control" placeholder="US / CA / JP etc..."/></div>
                                    </div>
                                    <div class="form-group row">
                                        <label class="col-sm-6 ptop5 text-right form-control-label">Model</label>
                                        <div class="col-sm-6"><input type="text" ng-model="edit_prop.model" class="form-control" placeholder="Model"/></div>
                                    </div>
                                    <div class="form-group row">
                                        <label class="col-sm-6 ptop5 text-right form-control-label">Description</label>
                                        <div class="col-sm-6"><input type="text" ng-model="edit_prop.description" class="form-control" placeholder="Description..."/></div>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-sm-6 text-right"><label class="form-control-label">HA</label></div>
                                        <div class="col-sm-6">
                                            <md-switch aria-label="HA" ng-model="edit_prop.ha">HA</md-switch>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label class="col-sm-6 text-right form-control-label">AP/AM spares</label>
                                        <div class="col-sm-6"><input type="number" ng-model="edit_prop.lic.ap.spares" class="form-control tight" placeholder="qty" /></div>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-sm-6 text-right"><label class="form-control-label">PEFNG License?</label></div>
                                        <div class="col-sm-6">
                                            <md-switch aria-label="PEFNG licences" ng-model="plan.details.lic.pefng">
                                                {{ plan.details.lic.pefng ? 'Yes' : 'No' }}
                                            </md-switch>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-sm-6 text-right"><label class="form-control-label">RFP License?</label></div>
                                        <div class="col-sm-6">
                                            <md-switch aria-label="RFP licences" ng-model="plan.details.lic.rfp">
                                                {{ plan.details.lic.rfp ? 'Yes' : 'No' }}
                                            </md-switch>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-sm-offset-2 col-sm-10">
                                            <button type="submit" class="btn btn-primary" ng-click="updateLicenses(); savePlanProperties();">Save</button>
                                            <button class="btn btn-default pull-right" ng-click="toggleEdit('controllers')">Cancel</button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
    </div>
</div>
				<form>

					<div class="modal-footer">
					  <button type="button" ng-click="close()" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
					  <button type="button" ng-click="close('Save')" class="btn btn-success" data-dismiss="modal">Save</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
</script>
